Subject: signal-do-not-wakeup-self.patch
From: Thomas Gleixner <tglx@linutronix.de>
Date: Thu, 19 Mar 2009 12:09:57 +0100

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
---
 kernel/signal.c |    3 +++
 1 file changed, 3 insertions(+)

Index: linux-2.6-tip/kernel/signal.c
===================================================================
--- linux-2.6-tip.orig/kernel/signal.c
+++ linux-2.6-tip/kernel/signal.c
@@ -566,6 +566,9 @@ void signal_wake_up(struct task_struct *
 
 	set_tsk_thread_flag(t, TIF_SIGPENDING);
 
+	if (unlikely(t == current))
+		return;
+
 	/*
 	 * For SIGKILL, we want to wake it up in the stopped/traced/killable
 	 * case. We don't check t->state here because there is a race with it
