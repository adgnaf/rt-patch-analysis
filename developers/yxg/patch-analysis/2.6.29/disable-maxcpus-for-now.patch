Subject: disable-maxcpus-for-now.patch
From: Thomas Gleixner <tglx@linutronix.de>
Date: Thu, 12 Mar 2009 15:13:56 +0100

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
---
 arch/x86/Kconfig       |    2 +-
 arch/x86/Kconfig.debug |    1 +
 lib/Kconfig            |    1 +
 3 files changed, 3 insertions(+), 1 deletion(-)

Index: linux-2.6-tip/arch/x86/Kconfig
===================================================================
--- linux-2.6-tip.orig/arch/x86/Kconfig
+++ linux-2.6-tip/arch/x86/Kconfig
@@ -663,7 +663,7 @@ config IOMMU_API
 
 config MAXSMP
 	bool "Configure Maximum number of SMP Processors and NUMA Nodes"
-	depends on X86_64 && SMP && DEBUG_KERNEL && EXPERIMENTAL
+	depends on 0 && X86_64 && SMP && DEBUG_KERNEL && EXPERIMENTAL
 	select CPUMASK_OFFSTACK
 	default n
 	---help---
Index: linux-2.6-tip/arch/x86/Kconfig.debug
===================================================================
--- linux-2.6-tip.orig/arch/x86/Kconfig.debug
+++ linux-2.6-tip/arch/x86/Kconfig.debug
@@ -85,6 +85,7 @@ config DEBUG_PER_CPU_MAPS
 	bool "Debug access to per_cpu maps"
 	depends on DEBUG_KERNEL
 	depends on SMP
+	depends on !PREEMPT_RT
 	default n
 	---help---
 	  Say Y to verify that the per_cpu map being accessed has
Index: linux-2.6-tip/lib/Kconfig
===================================================================
--- linux-2.6-tip.orig/lib/Kconfig
+++ linux-2.6-tip/lib/Kconfig
@@ -176,6 +176,7 @@ config HAVE_LMB
 
 config CPUMASK_OFFSTACK
 	bool "Force CPU masks off stack" if DEBUG_PER_CPU_MAPS
+	depends on !PREEMPT_RT && BROKEN
 	help
 	  Use dynamic allocation for cpumask_var_t, instead of putting
 	  them on the stack.  This is a bit more expensive, but avoids
