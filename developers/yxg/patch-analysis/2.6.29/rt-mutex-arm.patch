---
 arch/arm/kernel/entry-common.S |    3 ++-
 arch/arm/kernel/process.c      |    6 ++++--
 2 files changed, 6 insertions(+), 3 deletions(-)

Index: linux-2.6-tip/arch/arm/kernel/entry-common.S
===================================================================
--- linux-2.6-tip.orig/arch/arm/kernel/entry-common.S
+++ linux-2.6-tip/arch/arm/kernel/entry-common.S
@@ -55,7 +55,8 @@ work_pending:
 	b	ret_slow_syscall		@ Check work again
 
 work_resched:
-	bl	schedule
+	bl	__schedule
+
 /*
  * "slow" syscall return path.  "why" tells us if this was a real syscall.
  */
Index: linux-2.6-tip/arch/arm/kernel/process.c
===================================================================
--- linux-2.6-tip.orig/arch/arm/kernel/process.c
+++ linux-2.6-tip/arch/arm/kernel/process.c
@@ -167,9 +167,11 @@ void cpu_idle(void)
 			idle();
 		leds_event(led_idle_end);
 		tick_nohz_restart_sched_tick();
-		preempt_enable_no_resched();
-		schedule();
+		local_irq_disable();
+		__preempt_enable_no_resched();
+		__schedule();
 		preempt_disable();
+		local_irq_enable();
 	}
 }
 
